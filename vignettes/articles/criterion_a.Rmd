---
title: "Criterion A"
output:
  html_document:
    df_print: paged
---


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo=F, include = FALSE}
# library(ConR)
devtools::load_all()
```



Criterion A rely on an estimate of population size reduction measured over 3 generations OR 10 years.
  

## Example 1

A simple example. 
  
We have estimates of populations size for two years, the generation length is not provided (unknown). Thus the reduction is calculated over 10 years. The year of assessment is 2000. We do have an estimate of population size 10 years before the assessment. Thus we do not need a statistical method to estimate population sizes. The reduction is thus 40%.


```{r ex1}

pop <- c("1990" = 10000, "2000" = 6000)

criterion_A(x = pop,
            assess.year = 2000,
            subcriteria = c("A1", "A2"))

```

Notice that the argument `subcriteria` select only A1 and A2.

If you select all subcriteria (by default all are selected), you will get an error saying 'Too few time intervals to fit trends of population reduction'. This is because subcriteria A3 and A4 rely on projected population sizes (past and/or future population sizes). We need population models to calculate such projections and at least 3 population sizes estimates to fit those models.

```{r ex2, eval=T, error=TRUE}

pop <- c("1990" = 10000, "2000" = 6000)

criterion_A(x = pop,
            assess.year = 2000)

```

## Example 2


We have estimates of populations size for two years, the generation length is estimated to be 10 years.
Thus the reduction is calculated over 3 generation i.e. 30 years. The year of assessment is 2000. We do have an estimate of population size 30 years before the assessment. Thus we do not need a statistical method to estimate population sizes. The reduction is thus 90%.

```{r ex3}

pop <- c("1970" = 10000, "2000" = 1000)

criterion_A(x = pop,
            assess.year = 2000,
            subcriteria = c("A1", "A2"), 
            generation.time = 10)

```

The same remark of example 1 holds for this example concerning subcriteria.

```{r ex4, error=TRUE}

pop <- c("1990" = 10000, "2000" = 1000)

criterion_A(x = pop,
            assess.year = 2000,
            generation.time = 10)

```

Notice that you would have the same error if no estimate of population size is provided 30 years before the assessment. For example below, the population size is only provided for the year of assessment and 1990. To estimate population reduction 3 generations before the year of the assessment, a statistical model is need which can only be fit for at least 3 population sizes estimates.

```{r ex5, error=TRUE}

pop <- c("1990" = 10000, "2000" = 1000)

criterion_A(x = pop,
            assess.year = 2000,
            generation.time = 10)

```

## Example 3


We have estimates of populations size for three years, the generation length is estimated to be 10 years. We only ask for subcriteria A1 and A2.
The reduction is calculated over 3 generation i.e. 30 years. The year of assessment is 2000. We do have an estimate of population size 30 years before the assessment. Thus we do not need a statistical method to estimate population sizes. The reduction is thus 90%. The population size for 1940 is not taken into account.

```{r ex6}

pop <- c("1940" = 12000 ,
         "1970" = 10000,
         "2000" = 1000)

criterion_A(
   x = pop,
   assess.year = 2000,
   subcriteria = c("A1", "A2"),
   generation.time = 10
)

```

Subcriteria A3 and A4 can now be used because three estimates of population sizes are provided and thus statistical models can be fitted. 

```{r ex7}

pop <- c("1940" = 12000 ,
         "1970" = 10000,
         "2000" = 1000)

criterion_A(x = pop,
            assess.year = 2000,
            generation.time = 10)

```

Notice that a population size estimate is projected by default 3 generation length after the assessment year (i.e. for 2030). Notice also that the predictive model chosen is quadratic.

*_Important remark_*
It is important to keep in mind that this is an over-simplified example. As stated in IUCN (2019), the model used to make the predictions can result in very different estimates. So, it is preferable that the user choose one or two of the models based on the best available information  on types of threat (i.e. patterns of exploitation or habitat loss), life history  and ecology of the taxon being evaluated or any other processes that may contribute to population decline. See IUCN (2019) for more details on the assumptions of each model. The selection of models based solely on their fit to population data should only be used for larger time series (Number of observations > 10). 


You may want to know more about the statistical model used. You can explore more in details the model using the `pop.decline.fit` function.

```{r ex7bis}

pop <- c("1940" = 12000 ,
         "1970" = 10000,
         "2000" = 1000)

pop.decline.fit(pop.size = pop, years = as.numeric(names(pop)))

```

## Example 4


Here a case where the assessment year is said to 2000 but this year is not provided in time series, hence assuming the closest year 1990 as assessment year.
No generation length is provided, hence the population size reduction is estimated 10 years before the asssement year i.e. 1980 which is provided. Not statistical model is needed.

```{r ex8}

pop = c("1980" = 9000,
        "1985" = 7500,
        "1990" = 6000)

criterion_A(
   x = pop,
   assess.year = 2000,
   subcriteria = c("A2"))

```

When no estimate of population size is available 10 years before the assessment year, this estimate is provided using a statistical model:

```{r ex8bis}

pop = c("1960" = 9000,
        "1985" = 7500,
        "1990" = 6000)

criterion_A(
   x = pop,
   assess.year = 2000,
   subcriteria = c("A2"))

```

Check the details of the model used:

```{r ex8tris}

pop.decline.fit(pop.size = pop,
                years = as.numeric(names(pop)),
                project.years = 1980)

```


## Example 5

Multi species.

Projections for several years provided (from 2002 to 2030).
Estimates of population sizes also provided (from 1970 to 2000).
No statistical models are needed because population sizes for projected years and population sizes 3 times the generation length before are provided.

```{r}
 
data(example_criterionA)

criterion_A(
   example_criterionA,
   years = seq(1970, 2000, by = 2),
   assess.year = 2000,
   project.years = seq(2002, 2030, by = 2),
   subcriteria = c("A1", "A2", "A3", "A4"),
   generation.time = 10
)

 
```




